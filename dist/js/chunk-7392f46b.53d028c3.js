(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7392f46b"],{1227:function(t,e,s){},"122e":function(t,e,s){"use strict";var a=s("cf84"),r=s.n(a);r.a},"214f":function(t,e,s){"use strict";var a=s("32e9"),r=s("2aba"),n=s("79e5"),o=s("be13"),i=s("2b4c");t.exports=function(t,e,s){var c=i(t),l=s(o,c,""[t]),u=l[0],h=l[1];n(function(){var e={};return e[c]=function(){return 7},7!=""[t](e)})&&(r(String.prototype,t,u),a(RegExp.prototype,c,2==e?function(t,e){return h.call(t,this,e)}:function(t){return h.call(t,this)}))}},"37b4":function(t,e,s){"use strict";var a=s("1227"),r=s.n(a);r.a},"386d":function(t,e,s){s("214f")("search",1,function(t,e,s){return[function(s){"use strict";var a=t(this),r=void 0==s?void 0:s[e];return void 0!==r?r.call(s,a):new RegExp(s)[e](String(a))},s]})},4810:function(t,e,s){"use strict";var a=s("ecb2"),r=s.n(a);r.a},"4e22":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"search"},[s("div",{staticClass:"search-box-wrapper"},[s("search-box",{ref:"searchBox",on:{query:t.onQueryChange}})],1),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.query,expression:"!query"}],ref:"shortcutWrapper",staticClass:"shortcut-wrapper"},[s("scroll",{ref:"shortcut",staticClass:"shortcut",attrs:{data:t.shortcut}},[s("div",[s("div",{staticClass:"hot-key"},[s("h1",{staticClass:"title"},[t._v("热门搜索")]),s("ul",t._l(t.hotKey,function(e){return s("li",{staticClass:"item",on:{click:function(s){t.addQuery(e.first)}}},[s("span",[t._v(t._s(e.first))])])}))]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.searchHistory.length,expression:"searchHistory.length"}],staticClass:"search-history"},[s("h1",{staticClass:"title"},[s("span",{staticClass:"text"},[t._v("搜索历史")]),s("span",{staticClass:"clear",on:{click:t.showConfirm}},[s("Icon",{attrs:{size:"22",type:"ios-trash-outline"}})],1)]),s("search-list",{attrs:{searches:t.searchHistory},on:{select:t.addQuery,delete:t.deleteSearchHistory}})],1)])])],1),s("div",{directives:[{name:"show",rawName:"v-show",value:t.query,expression:"query"}],ref:"searchResult",staticClass:"search-result"},[s("suggest",{ref:"suggest",attrs:{query:t.query},on:{select:t.saveSearch,listScroll:t.blurInput}})],1),s("confirm",{ref:"confirm",attrs:{text:"是否清空所有搜索历史?",confirmBtnText:"清空"},on:{confirm:t.clearSearchHistory}})],1)},r=[],n=s("c93e"),o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"searchBox"},[s("div",{staticClass:"search-box",class:t.themeNumber},[s("i",{staticClass:"icon-search"}),s("input",{directives:[{name:"model",rawName:"v-model",value:t.query,expression:"query"}],ref:"query",staticClass:"box",class:t.themeNum,attrs:{placeholder:t.placeholder},domProps:{value:t.query},on:{input:function(e){e.target.composing||(t.query=e.target.value)}}}),s("i",{directives:[{name:"show",rawName:"v-show",value:t.query,expression:"query"}],staticClass:"icon-delete",on:{click:t.clear}})])])},i=[],c=(s("cadf"),s("551c"),s("097d"),s("2f62")),l=s("8b55"),u={name:"search-box",props:{placeholder:{type:String,default:"搜索歌曲、歌手"}},computed:Object(n["a"])({themeNumber:function(){return 0===this.theme?"theme1":1===this.theme?"theme2":"theme3"},themeNum:function(){return 0===this.theme?"theme1-1":1===this.theme?"theme2-1":"theme3-1"}},Object(c["c"])(["theme"])),data:function(){return{query:""}},methods:{clear:function(){this.query=""},blur:function(){this.$refs.query.blur()},setQuery:function(t){this.query=t}},created:function(){var t=this;this.$watch("query",Object(l["a"])(function(e){t.$emit("query",e)},200))}},h=u,f=(s("122e"),s("2877")),d=Object(f["a"])(h,o,i,!1,null,"e3455a72",null);d.options.__file="search-box.vue";var g=d.exports,p=s("aada"),m=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("scroll",{ref:"suggest",staticClass:"suggest",attrs:{data:t.result,pullup:t.pullup,beforeScroll:t.beforeScroll},on:{scrollToEnd:t.searchMore,beforeScroll:t.listScroll}},[s("ul",{staticClass:"suggest-list"},[t._l(t.result,function(e){return s("li",{staticClass:"suggest-item",on:{click:function(s){t.selectItem(e)}}},[s("div",{staticClass:"icon"},[s("Icon",{attrs:{type:"ios-musical-notes-outline"}})],1),s("div",{staticClass:"name"},[s("p",{staticClass:"text"},[t._v(t._s(e.name)+" - "+t._s(e.ar))])])])}),s("loading",{directives:[{name:"show",rawName:"v-show",value:t.hasMore,expression:"hasMore"}],attrs:{title:t.title}})],2),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.hasMore&&!t.result.length,expression:"!hasMore && !result.length"}],staticClass:"no-result-wrapper"},[s("no-result",{attrs:{title:"抱歉，暂无搜索结果"}})],1)])},v=[],y=(s("386d"),s("ac6a"),s("7f7f"),s("c428")),b=s("b980"),C={name:"suggest",components:{Scroll:p["a"],Loading:y["a"],NoResult:b["a"]},props:{query:{type:String,default:""}},data:function(){return{page:1,pageTotal:-1,result:[],pullup:!0,hasMore:!0,songCount:0,title:"",beforeScroll:!0}},methods:Object(n["a"])({refresh:function(){this.$refs.suggest.refresh()},search:function(t,e){var s=this,a=this,r=[];a.hasMore=!0,this.$refs.suggest.scrollTo(0,0),a.$axios.get("api/search",{params:{keywords:t,limit:20,offset:e-1}}).then(function(t){200===t.data.code&&(a.songCount=t.data.result.songCount,a.songCount>0?(r=t.data.result.songs,-1===a.pageTotal&&0!==r.length&&(a.pageTotal=a.songCount%r.length,0===a.pageTotal?a.pageTotal=a.songCount/r.length:a.pageTotal=parseInt(a.songCount/r.length)+1),r.length>0&&a.$axios.all([a.loadSongUrl(r),a.loadSongDetail(r)]).then(a.$axios.spread(function(t,e){a.filterResult(e.data.songs),a.manageSongList(e.data.songs,t.data.data),a.checkMore(a.pageTotal)})).catch(function(t){console.log(t)})):s.hasMore=!1)}).catch(function(t){console.log(t)})},searchMore:function(){this.hasMore&&(this.page++,this.loadMore(this.query,this.page))},loadMore:function(t,e){var s=this,a=[];s.hasMore=!0,s.$axios.get("api/search",{params:{keywords:t,limit:20,offset:e-1}}).then(function(t){200===t.data.code&&(s.songCount=t.data.result.songCount,a=t.data.result.songs,a.length>0&&s.$axios.all([s.loadSongUrl(a),s.loadSongDetail(a)]).then(s.$axios.spread(function(t,e){s.filterResult(e.data.songs),s.manageSongList(e.data.songs,t.data.data),s.checkMore(s.pageTotal)})).catch(function(t){console.log(t)}))}).catch(function(t){console.log(t)})},listScroll:function(){this.$emit("listScroll")},checkMore:function(t){this.page+1>t&&(this.hasMore=!1)},loadSongUrl:function(t){for(var e=this,s="",a=0;a<t.length;a++)s+=t[a].id+",";return s=s.substring(0,s.length-1),e.$axios.get("api/song/url",{params:{id:s}})},loadSongDetail:function(t){for(var e=this,s="",a=0;a<t.length;a++)s+=t[a].id+",";return s=s.substring(0,s.length-1),e.$axios.get("api/song/detail",{params:{ids:s}})},selectItem:function(t){this.insertSong(t),this.$emit("select",t)},manageSongList:function(t,e){for(var s=this,a=0;a<t.length;a++){var r={id:"",name:"",ar:"",al:"",imgURL:"",songURL:"",time:0};r.id=t[a].id,r.name=t[a].name,r.ar=t[a].ar,r.al=t[a].al.name,r.imgURL=t[a].al.picUrl,r.time=t[a].dt;for(var n=0;n<e.length;n++)if(t[a].id===e[n].id){r.songURL=e[n].url;break}s.result.push(r)}},filterResult:function(t){t.forEach(function(t){var e=[],s="";t.ar.forEach(function(t){e.push(t.name)}),s=e.join("/"),t.ar=s})}},Object(c["b"])(["insertSong"])),watch:{query:function(){this.result=[],this.page=1,this.pageTotal=-1,this.songCount=0,this.query&&this.search(this.query,this.page)}}},x=C,w=(s("b636"),Object(f["a"])(x,m,v,!1,null,"010bc1f0",null));w.options.__file="suggest.vue";var S=w.exports,_=s("795d"),$=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{directives:[{name:"show",rawName:"v-show",value:t.searches.length,expression:"searches.length"}],staticClass:"search-list"},[s("transition-group",{attrs:{name:"list",tag:"ul"}},t._l(t.searches,function(e){return s("li",{key:e,staticClass:"search-item",on:{click:function(s){t.selectItem(e)}}},[s("span",{staticClass:"text"},[t._v(t._s(e))]),s("span",{staticClass:"icon",on:{click:function(s){s.stopPropagation(),t.deleteOne(e)}}},[s("Icon",{attrs:{size:"22",type:"ios-close"}})],1)])}))],1)},q=[],O={props:{searches:{type:Array,default:[]}},methods:{selectItem:function(t){this.$emit("select",t)},deleteOne:function(t){this.$emit("delete",t)}}},j=O,k=(s("f55f"),Object(f["a"])(j,$,q,!1,null,"5b2220ba",null));k.options.__file="search-list.vue";var M=k.exports,N=s("510f"),H={name:"search",mixins:[N["b"]],data:function(){return{hotKey:[],query:""}},components:{SearchBox:g,Suggest:S,SearchList:M,Confirm:_["a"],Scroll:p["a"]},computed:Object(n["a"])({shortcut:function(){return this.hotKey.concat(this.searchHistory)}},Object(c["c"])(["searchHistory"])),watch:{query:function(t){var e=this;t||setTimeout(function(){e.$refs.shortcut.refresh()},20)}},methods:Object(n["a"])({handlePlayList:function(t){var e=t.length>0?"60px":"";this.$refs.shortcutWrapper.style.bottom=e,this.$refs.shortcut.refresh(),this.$refs.searchResult.style.bottom=e,this.$refs.suggest.refresh()},blurInput:function(){this.$refs.searchBox.blur()},loadHotSearch:function(){var t=this;t.$axios.get("api/search/hot").then(function(e){200===e.data.code&&(t.hotKey=e.data.result.hots)}).catch(function(t){console.log(t)})},addQuery:function(t){this.$refs.searchBox.setQuery(t)},onQueryChange:function(t){this.query=t},saveSearch:function(){this.saveSearchHistory(this.query)},showConfirm:function(){this.$refs.confirm.show()}},Object(c["b"])(["saveSearchHistory","deleteSearchHistory","clearSearchHistory"])),created:function(){this.loadHotSearch()}},T=H,R=(s("37b4"),Object(f["a"])(T,a,r,!1,null,"5a5e5354",null));R.options.__file="search.vue";e["default"]=R.exports},"83e9":function(t,e,s){},a094:function(t,e,s){},b636:function(t,e,s){"use strict";var a=s("a094"),r=s.n(a);r.a},b980:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"no-result"},[s("div",{staticClass:"no-result-icon"},[s("Icon",{attrs:{type:"ios-outlet-outline"}})],1),s("p",{staticClass:"no-result-text"},[t._v(t._s(t.title))])])},r=[],n={name:"no-result",props:{title:{type:String,default:""}}},o=n,i=(s("4810"),s("2877")),c=Object(i["a"])(o,a,r,!1,null,"fbe78d20",null);c.options.__file="no-result.vue";e["a"]=c.exports},c428:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"loading"},[s("img",{attrs:{width:"40",height:"30",src:"https://cdn.xieyezi.com/loading.gif"}}),s("p",{staticClass:"desc",class:t.themeNumber},[t._v(t._s(t.title))])])},r=[],n=s("c93e"),o=(s("cadf"),s("551c"),s("097d"),s("2f62")),i={props:{title:{type:String,default:"玩命载入中..."}},computed:Object(n["a"])({themeNumber:function(){return 0===this.theme?"theme1":1===this.theme?"theme2":"theme3"}},Object(o["c"])(["theme"]))},c=i,l=(s("d89d"),s("2877")),u=Object(l["a"])(c,a,r,!1,null,"078c5288",null);u.options.__file="loading.vue";e["a"]=u.exports},cf84:function(t,e,s){},d89d:function(t,e,s){"use strict";var a=s("eb40"),r=s.n(a);r.a},eb40:function(t,e,s){},ecb2:function(t,e,s){},f55f:function(t,e,s){"use strict";var a=s("83e9"),r=s.n(a);r.a}}]);